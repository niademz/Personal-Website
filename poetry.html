<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oluwaniademi Ogundana - My Poetry</title>
  <style>
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --header-background: #f4f4f4;
      --link-color: #0645AD;
      --button-color: #007bff;
    }
    [data-theme="dark"] {
      --background-color: #121212;
      --text-color: #e0e0e0;
      --header-background: #1f1f1f;
      --link-color: #bb86fc;
      --button-color: #bb86fc;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    .header {
      display: flex;
      align-items: center;
      background-color: var(--header-background);
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 10px;
      z-index: 1;
    }
    .header img {
      border-radius: 50%;
      margin-right: 20px;
      width: 100px;
      height: 100px;
      object-fit: cover;
      z-index: 1;
    }
    .header div{
      z-index: 1;
    }
    .header header{
      z-index: 1;
      position: relative;
    }
    .theme-toggle-button {
      cursor: pointer;
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin-top: 10px;
      margin-left: 0;
      display: inline-block;
      transition: background-color 0.3s;
      font-size: 10px;
      line-height: 1.5;
    }
    .section {
      margin-bottom: 30px;
    }
    #emotion-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px auto;
      max-width: 600px;
    }
    #emotion-bar button {
      background: none;
      border: 1px solid var(--link-color);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    #emotion-bar button:hover,
    #emotion-bar button.active {
      background-color: var(--link-color);
      color: white;
    }
    #poem-container {
      background-color: var(--header-background);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #poem-container h2 {
      margin-top: 0;
      border-bottom: 2px solid var(--button-color);
      padding-bottom: 5px;
    }
    #poem-container pre {
      white-space: pre-wrap;
      font-family: inherit;
    }
    .poetry-button {
      cursor: pointer;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin: 0 10px;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    .poetry-button:hover {
      background-color: #0056b3;
    }
    .poem-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 800px;        
      margin: 0 auto 40px;     
      gap: 20px;
      z-index: 1;               
    }

    /* poem container flex‚Äëfills between the buttons */
    #poem-container {
      flex: 1;
      background-color: var(--header-background);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;      /* so pop‚Äëouts (like glow) still work */
      height: 80vh;        
      overflow-y: auto;
      z-index: 1;
    }

    .poem-line {
      display: block;
      padding: 4px 0;
      transition: opacity 0.3s, font-weight 0.3s;
    }
    .poem-line.dimmed {
      opacity: 0.3;
      font-weight: normal;
    }
    .poem-line.highlighted {
      opacity: 1;
      font-weight: bold;
    }

    /* nav buttons now in normal flow, no absolute positioning */
    .nav-button {
      flex: 0 0 auto;
      font-size: 18px;
      padding: 10px 16px;
      opacity: 0.8;
      transition: opacity 0.2s;
      z-index: 1;
    }

    .nav-button:hover {
    opacity: 1;
    }
    a {
      color: var(--link-color);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    /* Joy pop */
    .joy-pop {
      text-shadow: 0 0 8px rgba(255,215,0,0.8), 0 0 16px rgba(255,215,0,0.5);
    }

    /* Sadness blur & grayscale */
    .sad-blur {
      filter: grayscale(0.7) blur(2px);
    }

    /* Fear shake */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%,60% { transform: translateX(-5px); }
      40%,80% { transform: translateX(5px); }
    }
    .fear-shake {
      animation: shake 0.9s ease-in-out infinite;
    }

    /* Surprise flash */
    @keyframes flash {
      0%,100% { opacity:1; }
      50%     { opacity:0.2; }
    }
    .surprise-flash {
      animation: flash 0.2s ease-in-out;
    }

    /* Nostalgia sepia */
    .nostalgia-sepia {
      filter: sepia(0.5);
    }

    /* Longing pan the body background */
    @keyframes pan-bg {
      from { background-position: 0% 50%; }
      to   { background-position: 100% 50%; }
    }
    .longing-pan {
      background-size: 200% 200%;
      animation: pan-bg 20s linear infinite;
    }

    /* Hope gradient overlay */
    .hope-gradient {
      position: relative;
    }
    .hope-gradient::after {
      content: '';
      pointer-events: none;
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.4), transparent 70%);
    }

    /* Contempt skew */
    .contempt-skew {
      transform: skewY(-1deg);
    }

    /* Awe glow */
    @keyframes glow {
      from { box-shadow: 0 0 0 rgba(255,255,255,0); }
      to   { box-shadow: 0 0 20px rgba(255,255,255,0.6); }
    }
    .awe-glow {
      animation: glow 1s ease-in-out infinite alternate;
    }

    /* Melancholy desaturate */
    .melancholy-tone {
      filter: grayscale(100%) contrast(0.9) brightness(0.8);
    }
    #star-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      pointer-events: none;
      z-index: -1;        /* sits behind poem-container */
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      opacity: 0;
      animation-name: twinkle;
      animation-iteration-count: infinite;
      animation-direction: alternate;
    }

    @keyframes twinkle {
      from { opacity: 0.1; }
      to   { opacity: 1; }
    }
  </style>
</head>
<body>
  <header class="header">
    <img src="profile_picture.png" alt="Profile Picture">
    <div>
      <h1>My Poetry!!</h1>
      <button class="theme-toggle-button" onclick="toggleTheme()">Toggle Dark Mode</button>
      <a href="index.html" class="poetry-button">Back to Home</a>
    </div>
  </header>

  <div id="emotion-bar" class="section">
    <button data-emo="Happiness" title="Happiness">üòä</button>
    <button data-emo="Anger" title="Anger">üò†</button>
    <button data-emo="Joy" title="Joy">üòÉ</button>
    <button data-emo="Sadness" title="Sadness">üò¢</button>
    <button data-emo="Fear" title="Fear">üò±</button>
    <button data-emo="Surprise" title="Surprise">üò≤</button>
    <button data-emo="Nostalgia" title="Nostalgia">üåÖ</button>
    <button data-emo="Longing" title="Longing">üí≠</button>
    <button data-emo="Hope" title="Hope">üåü</button>
    <button data-emo="Contempt" title="Contempt">üòí</button>
    <button data-emo="Awe" title="Awe">üòÆ</button>
    <button data-emo="Melancholy" title="Melancholy">üåßÔ∏è</button>
  </div>

  <main class="section">
    <div class="poem-wrapper">
      <button id="prevBtn" class="poetry-button nav-button">‚Üê</button>
      <div id="poem-container">
        <!-- injected poem -->
      </div>
      <button id="nextBtn" class="poetry-button nav-button">‚Üí</button>
    </div>
  </main>

  <script>
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    });
  </script>

  <script type="module">
    import { loadModel, predictEmotionScores } from './scripts/infer-browser.js';

    const emotions = ['Happiness','Anger','Joy','Sadness','Fear','Surprise','Nostalgia','Longing','Hope','Contempt','Awe','Melancholy'];
    let poems = [], currentIndex = 0, filterIdx = null;
    let starFieldCreated = false;

    function enableNightSky() {
      if (!starFieldCreated) {
        const field = document.createElement('div');
        field.id = 'star-field';
        for (let i = 0; i < 100; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.top    = Math.random() * 100 + '%';
          star.style.left   = Math.random() * 100 + '%';
          star.style.animationDelay    = (Math.random() * 5) + 's';
          star.style.animationDuration = (1 + Math.random() * 2) + 's';
          field.appendChild(star);
        }
        document.body.appendChild(field);
        starFieldCreated = true;
      }
    }

    function disableNightSky() {
      const field = document.getElementById('star-field');
      if (field) {
        field.remove();
        starFieldCreated = false;
      }
    }

    async function init() {
      await loadModel();
      poems = await fetch('/data/poems.json').then(r => r.json());
      renderPoem();
      document.getElementById('prevBtn').onclick = () => {
        currentIndex = (currentIndex - 1 + poems.length) % poems.length;
        renderPoem();
        };
        document.getElementById('nextBtn').onclick = () => {
        currentIndex = (currentIndex + 1) % poems.length;
        renderPoem();
        };
        document.querySelectorAll('#emotion-bar button').forEach((btn,i) => {
        btn.addEventListener('mouseenter', () => applyFilter(i));
        btn.addEventListener('mouseleave', () => { if (filterIdx === null) clearFilter(); });
        btn.addEventListener('click', () => {
          filterIdx = filterIdx === i ? null : i;
          document.querySelectorAll('#emotion-bar button').forEach(b => b.classList.remove('active'));
          if (filterIdx !== null) document.querySelectorAll('#emotion-bar button')[filterIdx].classList.add('active');
          filterIdx === null ? clearFilter() : applyFilter(filterIdx);
        });
      });
    }

    function renderPoem() {
      const { title, text } = poems[currentIndex];
      const lines = text.split('\n');
      const container = document.getElementById('poem-container');
      container.innerHTML = `<h2>${title}</h2>`;
      lines.forEach(line => {
        if (line === '') {
          const br = document.createElement('br');
          container.appendChild(br);
        } else {
          const span = document.createElement('span');
          span.className = 'poem-line';
          span.textContent = line;
          span.dataset.scores = JSON.stringify(predictEmotionScores(line));
          container.appendChild(span);
        }
      });
      const scores = predictEmotionScores(text);
      applyTheming(scores, title + '' + text);
      clearFilter();
    }

    function applyTheming([h, a, j, s, f, sp, n, l, ho, c, aw, m], fullText) {
      const pc = document.getElementById('poem-container');
      const body = document.body;

      // 1) Base hue + opacity by happiness & sadness
      const hue     = Math.round(h * 36);             // 0‚Äì360¬∞
      const opacity = 0.4 + (s / 10) * 0.6;           // 0.4‚Äì1
      body.style.backgroundColor = `hsla(${hue},60%,50%,${opacity})`;

      // 2) Border color by anger
      if (a > 3) {
        pc.style.border = `4px solid rgba(255,0,0,${a/10})`;
      } else {
        pc.style.border = 'none';
      }

      // 3) Joy ‚Üí poppy text shadow
      if (j > 5) {
        pc.classList.add('joy-pop');
      } else {
        pc.classList.remove('joy-pop');
      }

      // 4) Sadness ‚Üí grayscale + blur filter
      if (s > 5) {
        pc.classList.add('sad-blur');
      } else {
        pc.classList.remove('sad-blur');
      }

      // 5) Fear ‚Üí shake animation
      if (f > 5) {
        pc.classList.add('fear-shake');
      } else {
        pc.classList.remove('fear-shake');
      }

      // 6) Surprise ‚Üí flash
      if (sp > 7) {
        pc.classList.add('surprise-flash');
        setTimeout(() => pc.classList.remove('surprise-flash'), 200);
      }

      // 7) Nostalgia ‚Üí sepia wash
      if (n > 5) {
        pc.classList.add('nostalgia-sepia');
      } else {
        pc.classList.remove('nostalgia-sepia');
      }

      // 8) Longing ‚Üí slow background pan
      if (l > 5) {
        body.classList.add('longing-pan');
      } else {
        body.classList.remove('longing-pan');
      }

      // 9) Hope ‚Üí gentle gradient overlay
      if (ho > 5) {
        pc.classList.add('hope-gradient');
      } else {
        pc.classList.remove('hope-gradient');
      }

      // 10) Contempt ‚Üí skew
      if (c > 5) {
        pc.classList.add('contempt-skew');
      } else {
        pc.classList.remove('contempt-skew');
      }

      // 11) Awe ‚Üí glow
      if (aw > 5) {
        pc.classList.add('awe-glow');
      } else {
        pc.classList.remove('awe-glow');
      }

      const grayPct = m * 10               
      const bright  = 1 - m * 0.02         
      const sat     = 1 - m * 0.05         

      pc.style.filter = `
        grayscale(${grayPct}%)
        brightness(${bright})
        saturate(${sat})
      `.trim()

      if (fullText.toLowerCase().includes('night')) {
        enableNightSky();
      } else {
        disableNightSky();
      }
    }

    function applyFilter(eIdx) {
      document.querySelectorAll('.poem-line').forEach(span => {
        const scores = JSON.parse(span.dataset.scores);
        if (scores[eIdx] >= 4) {
          span.classList.add('highlighted'); span.classList.remove('dimmed');
        } else {
          span.classList.add('dimmed'); span.classList.remove('highlighted');
        }
      });
    }

    function clearFilter() {
      document.querySelectorAll('.poem-line').forEach(span => {
        span.classList.remove('highlighted','dimmed');
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
