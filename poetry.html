<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oluwaniademi Ogundana - My Poetry</title>
  <style>
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --header-background: #f4f4f4;
      --link-color: #0645AD;
      --button-color: #007bff;
    }
    [data-theme="dark"] {
      --background-color: #121212;
      --text-color: #e0e0e0;
      --header-background: #1f1f1f;
      --link-color: #bb86fc;
      --button-color: #bb86fc;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    .header {
      display: flex;
      align-items: center;
      background-color: var(--header-background);
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 10px;
      z-index: 1;
    }
    .header img {
      border-radius: 50%;
      margin-right: 20px;
      width: 100px;
      height: 100px;
      object-fit: cover;
      z-index: 1;
    }
    .header div{
      z-index: 1;
    }
    .header header{
      z-index: 1;
      position: relative;
    }
    .theme-toggle-button {
      cursor: pointer;
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin-top: 10px;
      margin-left: 0;
      display: inline-block;
      transition: background-color 0.3s;
      font-size: 10px;
      line-height: 1.5;
    }
    .section {
      margin-bottom: 30px;
    }
    #poem-container {
      background-color: var(--header-background);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    #poem-container h2 {
      margin-top: 0;
      border-bottom: 2px solid var(--button-color);
      padding-bottom: 5px;
    }
    #poem-container pre {
      white-space: pre-wrap;
      font-family: inherit;
    }
    .poetry-button {
      cursor: pointer;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin: 0 10px;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    .poetry-button:hover {
      background-color: #0056b3;
    }
    .poem-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  max-width: 800px;        
  margin: 0 auto 40px;     
  gap: 20px;
  z-index: 1;               
}

/* poem container flex‑fills between the buttons */
#poem-container {
  flex: 1;
  background-color: var(--header-background);
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  position: relative;      /* so pop‑outs (like glow) still work */
  height: 80vh;        
  overflow-y: auto;
  z-index: 1;
}

/* nav buttons now in normal flow, no absolute positioning */
.nav-button {
  flex: 0 0 auto;
  font-size: 18px;
  padding: 10px 16px;
  opacity: 0.8;
  transition: opacity 0.2s;
  z-index: 1;
}

    .nav-button:hover {
    opacity: 1;
    }
    a {
      color: var(--link-color);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }
    /* Joy pop */
    .joy-pop {
      text-shadow: 0 0 8px rgba(255,215,0,0.8), 0 0 16px rgba(255,215,0,0.5);
    }

    /* Sadness blur & grayscale */
    .sad-blur {
      filter: grayscale(0.7) blur(2px);
    }

    /* Fear shake */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%,60% { transform: translateX(-5px); }
      40%,80% { transform: translateX(5px); }
    }
    .fear-shake {
      animation: shake 0.9s ease-in-out infinite;
    }

    /* Surprise flash */
    @keyframes flash {
      0%,100% { opacity:1; }
      50%     { opacity:0.2; }
    }
    .surprise-flash {
      animation: flash 0.2s ease-in-out;
    }

    /* Nostalgia sepia */
    .nostalgia-sepia {
      filter: sepia(0.5);
    }

    /* Longing pan the body background */
    @keyframes pan-bg {
      from { background-position: 0% 50%; }
      to   { background-position: 100% 50%; }
    }
    .longing-pan {
      background-size: 200% 200%;
      animation: pan-bg 20s linear infinite;
    }

    /* Hope gradient overlay */
    .hope-gradient {
      position: relative;
    }
    .hope-gradient::after {
      content: '';
      pointer-events: none;
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.4), transparent 70%);
    }

    /* Contempt skew */
    .contempt-skew {
      transform: skewY(-3deg);
    }

    /* Awe glow */
    @keyframes glow {
      from { box-shadow: 0 0 0 rgba(255,255,255,0); }
      to   { box-shadow: 0 0 20px rgba(255,255,255,0.6); }
    }
    .awe-glow {
      animation: glow 1s ease-in-out infinite alternate;
    }

    /* Melancholy desaturate */
    .melancholy-tone {
      filter: saturate(0.5) brightness(0.9);
    }
    #star-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      pointer-events: none;
      z-index: -1;        /* sits behind poem-container */
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      opacity: 0;
      animation-name: twinkle;
      animation-iteration-count: infinite;
      animation-direction: alternate;
    }

    @keyframes twinkle {
      from { opacity: 0.1; }
      to   { opacity: 1; }
    }
  </style>
</head>
<body>
  <header class="header">
    <img src="profile_picture.png" alt="Profile Picture">
    <div>
      <h1>My Poetry!!</h1>
      <button class="theme-toggle-button" onclick="toggleTheme()">Toggle Dark Mode</button>
      <a href="index.html" class="poetry-button">Back to Home</a>
    </div>
  </header>

  <main class="section">
    <div class="poem-wrapper">
      <button id="prevBtn" class="poetry-button nav-button">←</button>
      <div id="poem-container">
        <!-- injected poem -->
      </div>
      <button id="nextBtn" class="poetry-button nav-button">→</button>
    </div>
  </main>

  <script>
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    });
  </script>

  <script type="module">
    import { loadModel, predictEmotionScores } from './scripts/infer-browser.js';

    let poems = [], currentIndex = 0;
    let starFieldCreated = false;

    function enableNightSky() {
      if (!starFieldCreated) {
        const field = document.createElement('div');
        field.id = 'star-field';
        for (let i = 0; i < 100; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.top    = Math.random() * 100 + '%';
          star.style.left   = Math.random() * 100 + '%';
          star.style.animationDelay    = (Math.random() * 5) + 's';
          star.style.animationDuration = (1 + Math.random() * 2) + 's';
          field.appendChild(star);
        }
        document.body.appendChild(field);
        starFieldCreated = true;
      }
    }

    function disableNightSky() {
      const field = document.getElementById('star-field');
      if (field) {
        field.remove();
        starFieldCreated = false;
      }
    }

    async function init() {
      await loadModel();
      poems = await fetch('/data/poems.json').then(r => r.json());
      renderPoem();
      document.getElementById('prevBtn').onclick = () => {
        currentIndex = (currentIndex - 1 + poems.length) % poems.length;
        renderPoem();
        };
        document.getElementById('nextBtn').onclick = () => {
        currentIndex = (currentIndex + 1) % poems.length;
        renderPoem();
        };
    }

    function renderPoem() {
      const { title, text } = poems[currentIndex];
      document.getElementById('poem-container').innerHTML = `
        <h2>${title}</h2>
        <pre>${text}</pre>
      `;
      const scores = predictEmotionScores(text);
      applyTheming(scores, title + '' + text);
    }

    function applyTheming([h, a, j, s, f, sp, n, l, ho, c, aw, m], fullText) {
      const pc = document.getElementById('poem-container');
      const body = document.body;

      // 1) Base hue + opacity by happiness & sadness
      const hue     = Math.round(h * 36);             // 0–360°
      const opacity = 0.4 + (s / 10) * 0.6;           // 0.4–1
      body.style.backgroundColor = `hsla(${hue},60%,50%,${opacity})`;

      // 2) Border color by anger
      if (a > 3) {
        pc.style.border = `4px solid rgba(255,0,0,${a/10})`;
      } else {
        pc.style.border = 'none';
      }

      // 3) Joy → poppy text shadow
      if (j > 5) {
        pc.classList.add('joy-pop');
      } else {
        pc.classList.remove('joy-pop');
      }

      // 4) Sadness → grayscale + blur filter
      if (s > 5) {
        pc.classList.add('sad-blur');
      } else {
        pc.classList.remove('sad-blur');
      }

      // 5) Fear → shake animation
      if (f > 5) {
        pc.classList.add('fear-shake');
      } else {
        pc.classList.remove('fear-shake');
      }

      // 6) Surprise → flash
      if (sp > 7) {
        pc.classList.add('surprise-flash');
        setTimeout(() => pc.classList.remove('surprise-flash'), 200);
      }

      // 7) Nostalgia → sepia wash
      if (n > 5) {
        pc.classList.add('nostalgia-sepia');
      } else {
        pc.classList.remove('nostalgia-sepia');
      }

      // 8) Longing → slow background pan
      if (l > 5) {
        body.classList.add('longing-pan');
      } else {
        body.classList.remove('longing-pan');
      }

      // 9) Hope → gentle gradient overlay
      if (ho > 5) {
        pc.classList.add('hope-gradient');
      } else {
        pc.classList.remove('hope-gradient');
      }

      // 10) Contempt → skew
      if (c > 5) {
        pc.classList.add('contempt-skew');
      } else {
        pc.classList.remove('contempt-skew');
      }

      // 11) Awe → glow
      if (aw > 5) {
        pc.classList.add('awe-glow');
      } else {
        pc.classList.remove('awe-glow');
      }

      // 12) Melancholy → desaturation
      if (m > 5) {
        pc.classList.add('melancholy-tone');
      } else {
        pc.classList.remove('melancholy-tone');
      }

      if (fullText.toLowerCase().includes('night')) {
        enableNightSky();
      } else {
        disableNightSky();
      }
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
