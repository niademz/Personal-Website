<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Oluwaniademi Ogundana - My Poetry</title>
  <style>
    :root {
      --background-color: #ffffff;
      --text-color: #000000;
      --header-background: #f4f4f4;
      --link-color: #0645AD;
      --button-color: #007bff;
    }
    [data-theme="dark"] {
      --background-color: #121212;
      --text-color: #e0e0e0;
      --header-background: #1f1f1f;
      --link-color: #bb86fc;
      --button-color: #bb86fc;
    }
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 20px;
      background-color: var(--background-color);
      color: var(--text-color);
    }
    .header {
      display: flex;
      align-items: center;
      background-color: var(--header-background);
      padding: 10px;
      margin-bottom: 20px;
      border-radius: 10px;
      z-index: 1;
    }
    .header img {
      border-radius: 50%;
      margin-right: 20px;
      width: 100px;
      height: 100px;
      object-fit: cover;
      z-index: 1;
    }
    .header div{
      z-index: 1;
    }
    .header header{
      z-index: 1;
      position: relative;
    }
    .theme-toggle-button {
      cursor: pointer;
      padding: 10px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin-top: 10px;
      margin-left: 0;
      display: inline-block;
      transition: background-color 0.3s;
      font-size: 10px;
      line-height: 1.5;
    }
    .section {
      margin-bottom: 30px;
    }
    #emotion-bar {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 8px;
      margin: 10px auto;
      max-width: 600px;
    }
    #emotion-bar button {
      background: none;
      border: 1px solid var(--link-color);
      border-radius: 4px;
      padding: 4px 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.2s, color 0.2s;
    }
    #emotion-bar button:hover,
    #emotion-bar button.active {
      background-color: var(--link-color);
      color: white;
    }
    #poem-container {
      background-color: var(--header-background);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      transition: filter 0.3s ease;
    }
    #poem-container h2 {
      margin-top: 0;
      border-bottom: 2px solid var(--button-color);
      padding-bottom: 5px;
    }
    #poem-container pre {
      white-space: pre-wrap;
      font-family: inherit;
    }
    .poetry-button {
      cursor: pointer;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      background-color: var(--button-color);
      color: var(--text-color);
      text-decoration: none;
      margin: 0 10px;
      transition: background-color 0.3s;
      font-size: 14px;
    }
    .poetry-button:hover {
      background-color: #0056b3;
    }
    .poem-wrapper {
      display: flex;
      align-items: center;
      justify-content: space-between;
      max-width: 800px;        
      margin: 0 auto 40px;     
      gap: 20px;
      z-index: 1;               
    }

    /* poem container flex‚Äëfills between the buttons */
    #poem-container {
      flex: 1;
      background-color: var(--header-background);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative;      /* so pop‚Äëouts (like glow) still work */
      height: 80vh;        
      overflow-y: auto;
      z-index: 1;
    }

    .poem-line {
      display: block;
      padding: 4px 0;
      transition: opacity 0.3s, font-weight 0.3s;
    }
    .poem-line.dimmed {
      opacity: 0.3;
      font-weight: normal;
    }
    .poem-line.highlighted {
      opacity: 1;
      font-weight: bold;
    }

    /* nav buttons now in normal flow, no absolute positioning */
    .nav-button {
      flex: 0 0 auto;
      font-size: 18px;
      padding: 10px 16px;
      opacity: 0.8;
      transition: opacity 0.2s;
      z-index: 1;
    }

    .nav-button:hover {
    opacity: 1;
    }
    a {
      color: var(--link-color);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    .model-select-wrapper {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-top: 10px;
      margin-left: 10px;
      background-color: var(--header-background);
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid var(--link-color);
    }

    .model-select-wrapper label {
      font-size: 14px;
      font-weight: bold;
      color: var(--text-color);
    }

    .model-select-wrapper select {
      font-size: 14px;
      padding: 5px 8px;
      border-radius: 5px;
      background-color: var(--background-color);
      color: var(--text-color);
      border: 1px solid var(--link-color);
      transition: background-color 0.3s, color 0.3s;
    }

    /* Joy pop */
    .joy-pop {
      text-shadow: 0 0 8px rgba(255,215,0,0.8), 0 0 16px rgba(255,215,0,0.5);
    }

    @keyframes angryPulse {
      0%   { box-shadow: 0 0 0 rgba(255, 0, 0, 0.0); }
      50%  { box-shadow: 0 0 15px rgba(255, 0, 0); }
      100% { box-shadow: 0 0 0 rgba(255, 0, 0, 0.0); }
    }
    .anger-pulse {
      border: 3px solid red;
      animation: angryPulse 1.2s infinite ease-in-out;
    }

    @keyframes rageShake {
      0%   { transform: translate(1px, 1px); }
      25%  { transform: translate(-2px, 0); }
      50%  { transform: translate(2px, -1px); }
      75%  { transform: translate(-1px, 2px); }
      100% { transform: translate(0, 0); }
    }
    .anger-rage {
      border: 2px solid red;
      animation: rageShake 0.2s infinite;
    }

    .anger-flame {
      border: 2px solid crimson;
      box-shadow: 0 0 8px 2px rgba(255, 0, 0, 0.7),
                  0 0 16px 4px rgba(255, 60, 0, 0.3);
    }

    @keyframes deepRedGlow {
      0%   { box-shadow: 0 0 0 rgba(255, 0, 0, 0); }
      50%  { box-shadow:
              0 0 15px 6px rgba(255, 0, 0, 0.8),
              0 0 25px 8px rgba(255, 100, 0, 0.3); }
      100% { box-shadow: 0 0 0 rgba(255, 0, 0, 0); }
    }
    .anger-pulse-intense {
      border: 3px solid red;
      animation: deepRedGlow 1.8s ease-in-out infinite;
    }

    /* Sadness blur & grayscale */
    @keyframes sadnessPulse {
    0% {
      filter: none;
    }
    50% {
      filter: grayscale(0.7) blur(1px) brightness(0.85);
    }
    100% {
      filter: none;
    }
  }

  .sad-blur {
    animation: sadnessPulse 4s ease-in-out infinite;
  }   

    /* Fear shake */
    @keyframes shake {
      0%,100% { transform: translateX(0); }
      20%,60% { transform: translateX(-5px); }
      40%,80% { transform: translateX(5px); }
    }
    .fear-shake {
      animation: shake 0.9s ease-in-out infinite;
    }

    /* Surprise flash */
    @keyframes flash {
      0%,100% { opacity:1; }
      50%     { opacity:0.2; }
    }

    /* replace your existing flash animation with something like this: */
    @keyframes surpriseFlash2 {
      0%   { opacity: 1; background-color: transparent; }
      25%  { opacity: 0.3; background-color: rgba(255, 255, 200, 0.6); }
      50%  { opacity: 1; background-color: rgba(255, 255, 200, 0); }
      100% { opacity: 1; background-color: transparent; }
    }

    .surprise-flash {
      animation: surpriseFlash2 0.4s ease-in-out;
    }

    /* Nostalgia sepia */
    .nostalgia-sepia {
      filter: sepia(0.8) contrast(1.1) brightness(0.9);
    }

    /* Longing pan the body background */
    @keyframes pan-bg {
      from { background-position: 0% 50%; }
      to   { background-position: 100% 50%; }
    }
    .longing-pan {
      background-size: 200% 200%;
      animation: pan-bg 20s linear infinite;
    }

    /* Hope gradient overlay */
    .hope-gradient {
      position: relative;
    }
    .hope-gradient::after {
      content: '';
      pointer-events: none;
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(255,255,255,0.4), transparent 70%);
    }

    /* Contempt skew */
    .contempt-skew {
      transform: skewY(-1deg);
    }

    /* Awe glow */
    @keyframes glow {
      from { box-shadow: 0 0 0 rgba(255,255,255,0); }
      to   { box-shadow: 0 0 20px rgba(255,255,255,0.6); }
    }
    .awe-glow {
      animation: glow 1s ease-in-out infinite alternate;
    }

    /* Melancholy desaturate */
    .melancholy-tone {
      filter: grayscale(100%) contrast(0.9) brightness(0.8);
    }
    #star-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: black;
      pointer-events: none;
      z-index: -1;        /* sits behind poem-container */
      overflow: hidden;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      opacity: 0;
      animation-name: twinkle;
      animation-iteration-count: infinite;
      animation-direction: alternate;
    }

    @keyframes twinkle {
      from { opacity: 0.1; }
      to   { opacity: 1; }
    }

    #sun-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      background: 
        radial-gradient(circle at top center,
          rgba(255, 223, 100, 0.5) 0%,
          rgba(255, 200, 50, 0.3) 40%,
          rgba(255, 180, 40, 0.2) 70%,
          transparent 100%),
        #cceeff; /* soft sky blue base */
      animation: sunPulse 10s ease-in-out infinite;
    }

    @keyframes sunPulse {
      0%, 100% { opacity: 0.7; }
      50%      { opacity: 1; }
    }

    #rain-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #a0a4a8; /* gentle rainy gray */
      overflow: hidden;
      pointer-events: none;
      z-index: -1;
    }

    .rain-drop {
      position: absolute;
      width: 1.5px;
      height: 15px;
      background: rgba(255, 255, 255, 0.3);
      animation: fall 0.8s linear infinite;
      border-radius: 0.5px;
    }

    @keyframes fall {
      0% {
        transform: translateY(-20px);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: translateY(100vh);
        opacity: 0;
      }
    }

    #storm-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #1c1c1c; /* deep stormy grey */
      overflow: hidden;
      pointer-events: none;
      z-index: -1;
      animation: storm-flash 6s infinite;
    }

    @keyframes storm-flash {
      0%, 5%, 10%, 15%, 20%, 100% {
        background-color: #1c1c1c;
      }
      3%, 12%, 18% {
        background-color: #f8f8ff; /* lightning flash */
      }
    }

    #fire-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      pointer-events: none;
      background: radial-gradient(circle at 50% 70%, #ff4500 0%, transparent 40%),
                  radial-gradient(circle at 60% 80%, #ff8c00 0%, transparent 40%),
                  radial-gradient(circle at 40% 85%, #ffa500 0%, transparent 40%);
      background-color: #1a0000;
      animation: flicker 1.5s infinite;
    }

    @keyframes flicker {
      0%, 100% {
        opacity: 1;
        filter: brightness(1) saturate(1.1);
      }
      50% {
        opacity: 0.8;
        filter: brightness(1.4) saturate(1.3);
      }
      75% {
        opacity: 0.9;
        filter: brightness(1.2) saturate(1.5);
      }
    }

    .fire-particle {
      position: absolute;
      bottom: 0;
      width: 4px;
      height: 4px;
      background: orange;
      border-radius: 50%;
      opacity: 0.8;
      animation: rise 3s linear infinite;
    }

    @keyframes rise {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 1;
      }
      50% {
        transform: translateY(-100px) translateX(-10px);
        opacity: 0.7;
      }
      100% {
        transform: translateY(-200px) translateX(10px);
        opacity: 0;
      }
    }

    #snow-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      overflow: hidden;
    }

    .snowflake {
      position: absolute;
      top: -10px;
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      opacity: 1;
      animation: fallAndSway 10s linear infinite;
    }

    @keyframes fallAndSway {
      0% {
        transform: translate(0, 0);
        opacity: 0.9;
      }
      25% {
        transform: translate(-10px, 25vh);
      }
      50% {
        transform: translate(0, 50vh);
      }
      75% {
        transform: translate(10px, 75vh);
      }
      100% {
        transform: translate(0, 110vh);
        opacity: 0.2;
      }
    }

    #ocean-field {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
      background: linear-gradient(
        180deg,
        #0099ff 0%,
        #00ccff 40%,
        #cceeff 100%
      );
      overflow: hidden;
    }

    .ocean-wave {
      position: absolute;
      bottom: 0;
      width: 200%;
      height: 200px;
      background: radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.3) 20%, transparent 70%);
      opacity: 0.3;
      animation: waveMotion 6s ease-in-out infinite;
      transform: translateX(-25%);
    }

    .ocean-wave:nth-child(2) {
      animation-delay: 2s;
      opacity: 0.5;
      animation-duration: 8s;
    }

    @keyframes waveMotion {
      0% { transform: translateX(-25%) translateY(0); }
      50% { transform: translateX(-50%) translateY(10px); }
      100% { transform: translateX(-25%) translateY(0); }
    }

    .memory-overlay::after {
      backdrop-filter: blur(2000px);
      content: '';
      position: fixed;
      inset: 0;
      z-index: -1;
      pointer-events: none;
      background: 
        radial-gradient(circle at center, rgba(112, 66, 20, 0.4), transparent 70%),
        repeating-linear-gradient(
          45deg,
          rgba(112, 66, 20, 0.05),
          rgba(112, 66, 20, 0.05) 10px,
          transparent 10px,
          transparent 20px
        );
      mix-blend-mode: overlay;
      animation: memoryFade 12s ease-in-out infinite;
    }

    @keyframes memoryFade {
      0%, 100% { opacity: 0.8; }
      50%      { opacity: 0.5; }
    }

  </style>
  <style>
  @media (max-width: 600px) {
    .header {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .header img {
      margin-right: 0;
      margin-bottom: 10px;
    }

    .header h1 {
      font-size: 1.5em;
    }

    .theme-toggle-button,
    .poetry-button {
      font-size: 12px;
      padding: 8px 14px;
      margin: 6px 4px;
    }

    .poem-wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: auto auto;
    grid-template-areas:
      "poem   poem"
      "prev   next";
    gap: 10px;
    margin: 0 auto 40px;
    max-width: 90%;
    justify-content: center;
  }

    .nav-button {
      width: auto;
      font-size: 16px;
      padding: 10px;
    }

   

    #emotion-bar button {
      font-size: 14px;
      padding: 4px 6px;
    }
    .nav-prev   { order: 1; }
    .nav-next   { order: 1; }

    .poem-nav-wrapper {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    #poem-container {
    grid-area: poem;
    width: 90%;
    height: auto;
    max-height: 70vh;
    padding: 15px;
  }

  /* prev button goes left */
  #prevBtn {
    grid-area: prev;
    justify-self: end;
  }

  /* next button goes right */
  #nextBtn {
    grid-area: next;
    justify-self: start;
  }

  .model-select-wrapper {
    margin: 10px auto;
    justify-content: center;
  }
  }
</style>
</head>
<body>
  <header class="header">
    <img src="profile_picture.png" alt="Profile Picture">
    <div>
      <h1>My Poetry!!</h1>
      <button class="theme-toggle-button" onclick="toggleTheme()">Toggle Dark Mode</button>
      <a href="index.html" class="poetry-button">Back to Home</a>
      <div class="model-select-wrapper">
        <label for="modelSelect">Model:</label>
        <select id="modelSelect">
          <option value="bow">Bag of Words</option>
          <option value="semantic">Semantic (TF-IDF + GloVe)</option>
        </select>
      </div>
    </div>
  </header>

  <div id="emotion-bar" class="section">
    <button data-emo="Happiness" title="Happiness">üòä</button>
    <button data-emo="Anger" title="Anger">üò†</button>
    <button data-emo="Joy" title="Joy">üòÉ</button>
    <button data-emo="Sadness" title="Sadness">üò¢</button>
    <button data-emo="Fear" title="Fear">üò±</button>
    <button data-emo="Surprise" title="Surprise">üò≤</button>
    <button data-emo="Nostalgia" title="Nostalgia">üåÖ</button>
    <button data-emo="Longing" title="Longing">üí≠</button>
    <button data-emo="Hope" title="Hope">üåü</button>
    <button data-emo="Contempt" title="Contempt">üòí</button>
    <button data-emo="Awe" title="Awe">üòÆ</button>
    <button data-emo="Melancholy" title="Melancholy">üåßÔ∏è</button>
  </div>

  <main class="section">
  <div class="poem-wrapper">
    <button id="prevBtn"
            class="poetry-button nav-button nav-prev">
      ‚Üê
    </button>
    <div id="poem-container">
      <!-- ‚Ä¶ -->
    </div>
    <button id="nextBtn"
            class="poetry-button nav-button nav-next">
      ‚Üí
    </button>
  </div>
</main>

  <script>
    function toggleTheme() {
      const current = document.documentElement.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("theme", next);
    }
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("theme") || "light";
      document.documentElement.setAttribute("data-theme", saved);
    });
  </script>

  <script type="module">
    import { loadModels, predictEmotionScoresBoW, predictEmotionScoresSemantic } from './scripts/infer-browser.js';

    let activeModel = 'bow';
    const emotions = ['Happiness','Anger','Joy','Sadness','Fear','Surprise','Nostalgia','Longing','Hope','Contempt','Awe','Melancholy'];
    let poems = [], currentIndex = 0, filterIdx = null;
    let starFieldCreated = false;

    function enableNightSky() {
      if (!starFieldCreated) {
        const field = document.createElement('div');
        field.id = 'star-field';
        for (let i = 0; i < 1000; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.top    = Math.random() * 100 + '%';
          star.style.left   = Math.random() * 100 + '%';
          star.style.animationDelay    = (Math.random() * 5) + 's';
          star.style.animationDuration = (1 + Math.random() * 2) + 's';
          field.appendChild(star);
        }
        document.body.appendChild(field);
        starFieldCreated = true;
      }
    }

    function disableNightSky() {
      const field = document.getElementById('star-field');
      if (field) {
        field.remove();
        starFieldCreated = false;
      }
    }

    function enableSunGlow() {
      if (!document.getElementById('sun-field')) {
        const sun = document.createElement('div');
        sun.id = 'sun-field';
        document.body.appendChild(sun);
      }
    }

    function disableSunGlow() {
      const sun = document.getElementById('sun-field');
      if (sun) sun.remove();
    }

    let rainFieldCreated = false;

    function enableRain() {
      if (!rainFieldCreated) {
        const field = document.createElement('div');
        field.id = 'rain-field';
        for (let i = 0; i < 200; i++) {
          const drop = document.createElement('div');
          drop.className = 'rain-drop';
          drop.style.left = Math.random() * 100 + 'vw';
          drop.style.animationDelay = (Math.random() * 0.8) + 's';
          drop.style.animationDuration = (0.5 + Math.random() * 0.5) + 's';
          field.appendChild(drop);
        }
        document.body.appendChild(field);
        rainFieldCreated = true;
      }
    }

    function disableRain() {
      const field = document.getElementById('rain-field');
      if (field) {
        field.remove();
        rainFieldCreated = false;
      }
    }

    let stormFieldCreated = false;

    function enableStorm() {
      if (!stormFieldCreated) {
        const field = document.createElement('div');
        field.id = 'storm-field';
        document.body.appendChild(field);
        stormFieldCreated = true;
      }
    }

    function disableStorm() {
      const field = document.getElementById('storm-field');
      if (field) {
        field.remove();
        stormFieldCreated = false;
      }
    }

    let fireFieldCreated = false;

    function enableFire() {
      if (!fireFieldCreated) {
        const field = document.createElement('div');
        field.id = 'fire-field';

        for (let i = 0; i < 80; i++) {
          const particle = document.createElement('div');
          particle.className = 'fire-particle';
          particle.style.left = Math.random() * 100 + 'vw';
          particle.style.animationDuration = (2 + Math.random() * 2) + 's';
          particle.style.animationDelay = (Math.random() * 3) + 's';
          field.appendChild(particle);
        }

        document.body.appendChild(field);
        fireFieldCreated = true;
      }
    }

    function disableFire() {
      const field = document.getElementById('fire-field');
      if (field) {
        field.remove();
        fireFieldCreated = false;
      }
    }

    let snowFieldCreated = false;

    function enableSnow() {
      if (!snowFieldCreated) {
        const field = document.createElement('div');
        console.log("Snow enabled");
        field.id = 'snow-field';

        for (let i = 0; i < 100; i++) {
          const flake = document.createElement('div');
          flake.className = 'snowflake';
          flake.style.left = Math.random() * 100 + 'vw';
          flake.style.animationDuration = 5 + Math.random() * 5 + 's';
          flake.style.animationDelay = Math.random() * 5 + 's';
          field.appendChild(flake);
        }

        document.body.appendChild(field);
        snowFieldCreated = true;
      }
    }

    function disableSnow() {
      const field = document.getElementById('snow-field');
      if (field) {
        field.remove();
        snowFieldCreated = false;
      }
    }

    let oceanFieldCreated = false;

    function enableOcean() {
      if (!oceanFieldCreated) {
        const field = document.createElement('div');
        field.id = 'ocean-field';

        for (let i = 0; i < 2; i++) {
          const wave = document.createElement('div');
          wave.className = 'ocean-wave';
          field.appendChild(wave);
        }

        document.body.appendChild(field);
        oceanFieldCreated = true;
      }
    }

    function disableOcean() {
      const field = document.getElementById('ocean-field');
      if (field) {
        field.remove();
        oceanFieldCreated = false;
      }
    }

    async function init() {
      await loadModels();
      poems = await fetch('/data/poems.json').then(r => r.json());

      document.getElementById('modelSelect').addEventListener('change', (e) => {
        activeModel = e.target.value;
        renderPoem();
      });

      document.getElementById('prevBtn').onclick = () => {
        currentIndex = (currentIndex - 1 + poems.length) % poems.length;
        renderPoem();
        };
        document.getElementById('nextBtn').onclick = () => {
        currentIndex = (currentIndex + 1) % poems.length;
        renderPoem();
        };
        document.querySelectorAll('#emotion-bar button').forEach((btn,i) => {
        btn.addEventListener('mouseenter', () => applyFilter(i));
        btn.addEventListener('mouseleave', () => { if (filterIdx === null) clearFilter(); });
        btn.addEventListener('click', () => {
          filterIdx = filterIdx === i ? null : i;
          document.querySelectorAll('#emotion-bar button').forEach(b => b.classList.remove('active'));
          if (filterIdx !== null) document.querySelectorAll('#emotion-bar button')[filterIdx].classList.add('active');
          filterIdx === null ? clearFilter() : applyFilter(filterIdx);
        });
      });

      renderPoem();
    }

    function getScores(text) {
      return activeModel === 'semantic'
        ? predictEmotionScoresSemantic(text)
        : predictEmotionScoresBoW(text);
    }

    function renderPoem() {
      const { title, text } = poems[currentIndex];
      const lines = text.split('\n');
      const container = document.getElementById('poem-container');
      container.innerHTML = `<h2>${title}</h2>`;
      lines.forEach(line => {
        if (line === '') {
          const br = document.createElement('br');
          container.appendChild(br);
        } else {
          const span = document.createElement('span');
          span.className = 'poem-line';
          span.textContent = line;
          span.dataset.scores = JSON.stringify(getScores(line));
          container.appendChild(span);
        }
      });
      const scores = getScores(text);
      applyTheming(scores, title + '' + text);
      clearFilter();
    }

    function applyTheming([h, a, j, s, f, sp, n, l, ho, c, aw, m], fullText) {
      const pc = document.getElementById('poem-container');
      const body = document.body;

      // 1) Base hue + opacity by happiness & sadness
      const hue     = Math.round(h * 36);             // 0‚Äì360¬∞
      const opacity = 0.4 + (s / 10) * 0.6;           // 0.4‚Äì1
      body.style.backgroundColor = `hsla(${hue},60%,50%,${opacity})`;

      // 2) Border color by anger
      pc.classList.remove('anger-pulse', 'anger-rage', 'anger-flame', 'anger-pulse-intense', 'anger-burn', 'anger-static');
      if (a > 7) {
        pc.classList.add('anger-pulse-intense');
      } else if (a > 3) {
        pc.classList.add('anger-flame');
      }


      // 3) Joy ‚Üí poppy text shadow
      if (j > 5) {
        pc.classList.add('joy-pop');
      } else {
        pc.classList.remove('joy-pop');
      }

      // 4) Sadness ‚Üí grayscale + blur filter
      if (s > 6) {
        pc.style.filter = "";     
        pc.classList.add('sad-blur');  
      } else {
        
        
        pc.classList.remove('sad-blur');

        const grayPct      = m * 10;                     
        const angerDampen  = Math.max(0, 1 - a / 10);

        pc.style.filter = `
          grayscale(${grayPct * angerDampen}%)
          brightness(${1 - m * 0.02 * angerDampen})
          saturate(${1 - m * 0.05 * angerDampen})
        `.trim();
      }

      // 5) Fear ‚Üí shake animation
      if (f > 5) {
        pc.classList.add('fear-shake');
      } else {
        pc.classList.remove('fear-shake');
      }

      // 6) Surprise ‚Üí flash
      if (sp > 7) {
        pc.classList.add('surprise-flash');
        setTimeout(() => pc.classList.remove('surprise-flash'), 400);
      }

      // 7) Nostalgia ‚Üí sepia wash
      if (n > 5) {
        pc.style.filter = "";
        pc.classList.remove('sad-blur');
        pc.classList.add('nostalgia-sepia');
      } else {
        pc.classList.remove('nostalgia-sepia');
      }

      // 8) Longing ‚Üí slow background pan
      if (l > 5) {
        body.classList.add('longing-pan');
      } else {
        body.classList.remove('longing-pan');
      }

      // 9) Hope ‚Üí gentle gradient overlay
      if (ho > 5) {
        pc.classList.add('hope-gradient');
      } else {
        pc.classList.remove('hope-gradient');
      }

      // 10) Contempt ‚Üí skew
      if (c > 5) {
        pc.classList.add('contempt-skew');
      } else {
        pc.classList.remove('contempt-skew');
      }

      // 11) Awe ‚Üí glow
      if (aw > 5) {
        pc.classList.add('awe-glow');
      } else {
        pc.classList.remove('awe-glow');
      }


      if (fullText.toLowerCase().includes('night')) {
        enableNightSky();
      } else {
        disableNightSky();
      }

      if (fullText.toLowerCase().includes('sun')) {
        enableSunGlow();
      } else {
        disableSunGlow();
      }

      

      const isStormy = fullText.toLowerCase().includes('storm') || fullText.toLowerCase().includes('stormy');
      if (isStormy) {
        enableStorm();
        body.style.backgroundColor = '#1c1c1c'; // override
      } else {
        disableStorm();
      }

      if (fullText.toLowerCase().includes('fire')) {
        enableFire();
      } else {
        disableFire();
      }

      if (fullText.toLowerCase().includes('snow') || fullText.toLowerCase().includes('ice')) {
        enableSnow();
        body.style.backgroundColor = '#b0d8ff';
      } else {
        disableSnow();
      }

      
      if (fullText.toLowerCase().includes('ocean ') || fullText.toLowerCase().includes('sea ') || fullText.toLowerCase().includes('water ')) {
        enableOcean();
        document.body.style.backgroundColor = '#00aaff';
      } else {
        disableOcean();
      }

      const isMemory = /\b(dream|memory|remember(ed|ing)?)\b/i.test(fullText.toLowerCase());
      if (isMemory) {
        document.body.classList.add('memory-overlay');
        document.body.style.backgroundColor = '#5c5c5c';
      } else {
        document.body.classList.remove('memory-overlay');
      }

      const isRainy = fullText.toLowerCase().includes('rain') || fullText.toLowerCase().includes('rainfall');
      if (isRainy) {
        enableRain();
        body.style.backgroundColor = '#a0a4a8'; // gentle rainy gray override
      } else {
        disableRain();
      }
    }

    function applyFilter(eIdx) {
      document.querySelectorAll('.poem-line').forEach(span => {
        const scores = JSON.parse(span.dataset.scores);
        if (scores[eIdx] >= 4) {
          span.classList.add('highlighted'); span.classList.remove('dimmed');
        } else {
          span.classList.add('dimmed'); span.classList.remove('highlighted');
        }
      });
    }

    function clearFilter() {
      document.querySelectorAll('.poem-line').forEach(span => {
        span.classList.remove('highlighted','dimmed');
      });
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
